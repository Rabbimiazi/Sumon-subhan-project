
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";


}


<section class="hero-wrap hero-wrap-2" style="background-image: url('/feliciano/images/bg_3.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text align-items-end justify-content-center">
            <div class="col-md-9 ftco-animate text-center mb-4">
                <h1 class="mb-2 bread">Admin</h1>
                <ul class="nav navbar-nav navbar-right">
                    <li>@Html.ActionLink("Register", "Register", "Account", routeValues: null, htmlAttributes: new { id = "registerLink" })</li>

                </ul>
                <p class="breadcrumbs"><span class="mr-2">Admin <i class="ion-ios-arrow-forward"></i></span> <span><a href="@Url.Action("Index","Role")">Management <i class="ion-ios-arrow-forward"></i></a></span></p>
            </div>
        </div>
    </div>
</section>



<section class="ftco-section">
    <div class="container">
        <div class="ftco-search">
            <div class="row">
                <div class="col-md-12 nav-link-wrap">
                    <div class="nav nav-pills d-flex text-center" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link ftco-animate active" id="v-pills-1-tab" data-toggle="pill" href="#v-pills-1" role="tab" aria-controls="v-pills-1" aria-selected="true">Coming Order</a>
                        <a class="nav-link ftco-animate" id="v-pills-2-tab" data-toggle="pill" href="#v-pills-2" role="tab" aria-controls="v-pills-2" aria-selected="false">Booked Order</a>
                        <a class="nav-link ftco-animate" id="v-pills-3-tab" data-toggle="pill" href="#v-pills-3" role="tab" aria-controls="v-pills-3" aria-selected="false">Menu List</a>
                        <a class="nav-link ftco-animate" id="v-pills-4-tab" data-toggle="pill" href="#v-pills-4" role="tab" aria-controls="v-pills-4" aria-selected="false">Ordered</a>
                        <a class="nav-link ftco-animate" id="v-pills-5-tab" data-toggle="pill" href="#v-pills-5" role="tab" aria-controls="v-pills-5" aria-selected="false">Contacted List</a>


                    </div>
                </div>
                <div class="col-md-12 tab-wrap">

                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-1" role="tabpanel" aria-labelledby="day-1-tab">
                            <div class="container">
                                <div class="panel panel-success">
                                    <div class="panel-heading"><h1>Reservation List</h1></div>
                                    <div class="panel-body">
                                        <table class="table table-striped table-dark" id="tbl">
                                            <thead>
                                                <tr>

                                                    <th scope="col">Name</th>
                                                    <th scope="col">Email</th>
                                                    <th scope="col">Phone</th>
                                                    <th scope="col">Date</th>
                                                    <th scope="col">Time</th>
                                                    <th scope="col">Options</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="tab-pane fade" id="v-pills-2" role="tabpanel" aria-labelledby="v-pills-day-2-tab">
                            <div class="container">
                                <div class="panel panel-success">
                                    <div class="panel-heading"><h1>Reservation Order</h1></div>
                                    <div class="panel-body">
                                        <table class="table table-striped table-dark" id="tblconf">
                                            <thead>
                                                <tr>

                                                    <th scope="col">Name</th>
                                                    <th scope="col">Email</th>
                                                    <th scope="col">Phone</th>
                                                    <th scope="col">Date</th>
                                                    <th scope="col">Time</th>
                                                    <th scope="col">Persons</th>
                                                    <th scope="col">Options</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-3" role="tabpanel" aria-labelledby="v-pills-day-3-tab">
                            <div class="container">
                                <div class="panel panel-success">
                                    @*<div class="panel-heading"><h1>Menue List</h1><p>Create</p></div>*@
                                    <span class="breadcrumbs"><span class="mr-2">Menue List<i class="ion-ios-arrow-forward"></i></span> <span><span style="color:darkred" data-toggle="modal" data-target="#exampleModal">Menue Create</span> <i class="ion-ios-arrow-forward"></i></span></span>
                                    <div class="panel-body">
                                        <table class="table table-striped table-dark" id="mnu">
                                            <thead>
                                                <tr>

                                                    <th scope="col">Menue Name</th>
                                                    <th scope="col">Dishes Title</th>
                                                    <th scope="col">Dishes Prices</th>
                                                    <th scope="col">Metarials</th>
                                                    <th scope="col">Is Active</th>
                                                    <th scope="col">Pictures</th>
                                                    <th scope="col">Options</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>



                        </div>
                        <div class="tab-pane fade" id="v-pills-4" role="tabpanel" aria-labelledby="v-pills-day-4-tab">
                            <div class="container">
                                <div class="panel panel-success">
                                    <div class="panel-heading"><h1>Ordered List</h1></div>
                                    <div class="panel-body">
                                        <table class="table table-striped table-dark" id="tblorder">
                                            <thead>
                                                <tr>

                                                    <th scope="col">Name</th>
                                                    <th scope="col">Email</th>
                                                    <th scope="col">Phone</th>
                                                    <th scope="col">Dish Name</th>
                                                    <th scope="col">Quantity</th>
                                                    <th scope="col">Total Price</th>
                                                    <th scope="col">Date</th>
                                                    <th scope="col">Options</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="v-pills-5" role="tabpanel" aria-labelledby="v-pills-day-5-tab">
                            <div class="container">
                                <div class="panel panel-success">
                                    <div class="panel-heading"><h1>Contact List</h1></div>
                                    <div class="panel-body">
                                        <table class="table table-striped table-dark" id="tblct">
                                            <thead>
                                                <tr>

                                                    <th scope="col">Name</th>
                                                    <th scope="col">Email</th>
                                                    <th scope="col">Phone</th>
                                                    <th scope="col">Subject</th>
                                                    <th scope="col">Message</th>
                                                    <th scope="col">Options</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="row">
    <section>
        <!-- Large modal -->
        @*<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg">Large modal</button>*@

        @*<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        ...
                    </div>
                </div>
            </div>*@
        <!-- Button trigger modal -->
        <!-- Modal -->
        <div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" @*aria-hidden="true"*@>
            <div class="modal-dialog  modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Menue Create</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <input type="text" id="menueid" hidden />
                            <div class="col-md-6">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Manue Name</label>
                                        <div class="select-wrap one-third">
                                            @*<div class="icon"><span class="ion-ios-arrow-down"></span></div>*@
                                            <select name="" id="menuname" class="form-control">
                                                <option value="Null">Manue Name</option>
                                                <option value="Breakfast">Breakfast</option>
                                                <option value="Lunch">Lunch</option>
                                                <option value="Dinner">Dinner</option>
                                                <option value="Drinks">Drinks</option>
                                                <option value="Desert">Desert</option>
                                                <option value="Detailsmenu">Details Menu</option>
                                            </select>
                                            <p class="nmerr" style="color:#f50909"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Dish Title</label>
                                        <input type="text" class="form-control" id="dishtitle" placeholder="Dish Title">
                                        <p class="tlerr" style="color:#f50909"></p>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Price</label>
                                        <input type="text" class="form-control" id="price" placeholder="Price">
                                        <p class="prerr" style="color:#f50909"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Materials</label>
                                        <input type="text" class="form-control" id="materials" placeholder="Materials">
                                        <p class="mterr" style="color:#f50909"></p>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Is Active</label>
                                        <input type="checkbox" class="form-control" id="active" name="active" placeholder="Active">

                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="">Picture</label>
                                        <div class="col-sm-4">

                                            <input type="file" name="uploadfile" id="txtimg" style="display:none;" />
                                            <label for="txtimg"><img src="https://img.icons8.com/nolan/64/000000/browse-folder.png"></label>

                                        </div>
                                        <div class="col-sm-4">
                                            <img src="" id="emppicture" height="110" width="110" class="img-rounded" />
                                            <p class="pcerr" style="color:#f50909"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="SaveMenue()">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

    </section>
</div>









@section scripts
{
    @*<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>*@
    <script type="text/javascript">

        $(document).ready(function () {

            LoadData();
            LoadConfirmData();
            LoadContact();
            LoadMenue();
            LoadOrder();

        })



        $("#savemes").click(function () {
            var obj = {
                Name: $("#name").val(),
                Email: $("#email").val(),
                Phone: $("#phone").val(),
                Subject: $("#subject").val(),
                Message: $("#message").val(),

            }
            $.ajax({
                url: "/Contact/ContactSave",
                type: "POST",
                dataType: "Json",
                data: JSON.stringify(obj),
                contentType: "application/Json"
            }).done(function (data) {




                clearall();
            }).fail(function (err) {
                console.log(err.responseText);
            });
        });//save

        function LoadData() {
            $.ajax({
                url: "/Admin/Reserveshow",
                type: "GET",
                dataType: "Json"
            }).done(function (data) {

                $("#tbl tbody").empty();
                for (var i = 0; i < data.length; i++) {

                    var bookdate;
                    if (data[i].Date != null) {

                        var pdate = new Date(parseInt(data[i].Date.substr(6)));
                        var date = new Date(pdate);
                        var year = date.getFullYear();
                        var rawmonth = date.getMonth() + 1 //getMonth is zero based;
                        var month = rawmonth < 10 ? '0' + rawmonth : rawmonth;
                        var rowday = date.getDate();
                        var day = rowday < 10 ? '0' + rowday : rowday;
                        bookdate = day + "-" + month + "-" + year;

                    }
                    else {

                        bookdate = null
                    }
                    $("#tbl tbody").append(
                        "<tr><td>" + data[i].Name + "</td>" +
                        "<td>" + data[i].Email + "</td>" +
                        "<td>" + data[i].Phone + "</td>" +
                        "<td>" + bookdate + "</td>" +
                        "<td>" + data[i].Time + "</td>" +
                        "<td>" + data[i].Person + "</td>" +
                        "<td><button class='btn btn-primary' onclick='edit(" + data[i].ReserveId + ")' >Confirm</button>" +
                        "<button class='btn btn-danger' onclick='deletestd(" + data[i].ReserveId + ")' >Delete</button></td>" +
                        "</tr>"
                    );
                }
            }).fail(function (err) {
                console.log(err);
            });
        }


        function LoadConfirmData() {
            $.ajax({
                url: "/Admin/ConfirmReserveshow",
                type: "GET",
                dataType: "Json"
            }).done(function (data) {

                $("#tblconf tbody").empty();
                for (var i = 0; i < data.length; i++) {

                    var bookdt;
                    if (data[i].Date != null) {

                        var pdate = new Date(parseInt(data[i].Date.substr(6)));
                        var date = new Date(pdate);
                        var year = date.getFullYear();
                        var rawmonth = date.getMonth() + 1 //getMonth is zero based;
                        var month = rawmonth < 10 ? '0' + rawmonth : rawmonth;
                        var rowday = date.getDate();
                        var day = rowday < 10 ? '0' + rowday : rowday;
                        bookdt = day + "-" + month + "-" + year;

                    }
                    else {

                        bookdt = null
                    }
                    $("#tblconf tbody").append(
                        "<tr><td>" + data[i].Name + "</td>" +
                        "<td>" + data[i].Email + "</td>" +
                        "<td>" + data[i].Phone + "</td>" +
                        "<td>" + bookdt + "</td>" +
                        "<td>" + data[i].Time + "</td>" +
                        "<td>" + data[i].Person + "</td>" +

                        "<td><button class='btn btn-danger' onclick='deletestd(" + data[i].ReserveId + ")' >Delete</button></td>" +
                        "</tr>"
                    );
                }
            }).fail(function (err) {
                console.log(err);
            });
        }


        function LoadContact() {
            $.ajax({
                url: "/Admin/Contactshow",
                type: "GET",
                dataType: "Json"
            }).done(function (data) {

                $("#tblct tbody").empty();
                for (var i = 0; i < data.length; i++) {


                    $("#tblct tbody").append(
                        "<tr><td>" + data[i].Name + "</td>" +
                        "<td>" + data[i].Email + "</td>" +
                        "<td>" + data[i].Phone + "</td>" +
                        "<td>" + data[i].Subject + "</td>" +
                        "<td>" + data[i].Message + "</td>" +
                        "<td><button class='btn btn-danger' onclick='deletecnt(" + data[i].ContactId + ")' >Delete</button></td>" +
                        "</tr>"
                    );
                }
            }).fail(function (err) {
                console.log(err);
            });
        }

        function deletestd(id) {

            $.ajax({
                url: "/Reserve/delete/" + id,
                type: "GET",
                dataType: "Json"
            }).done(function (data) {


                LoadData();

            }).fail(function (err) {

                console.log(err);
            });


        } //Delete


        function deletecnt(id) {

            $.ajax({
                url: "/Contact/delete/" + id,
                type: "GET",
                dataType: "Json"
            }).done(function (data) {


                LoadContact();

            }).fail(function (err) {

                console.log(err);
            });


        } //Delete

        function clearall() {
            $("#name").val('');
            $("#email").val('');
            $("#phone").val('');
            $("#subject").val('');
            $("#message").val('');


        }

        function edit(id) {

            $.ajax({
                url: "/Reserve/Confirm/" + id,
                type: "GET",
                dataType: "Json"
            }).done(function (data) {
                LoadData();

            }).fail(function (err) {

                console.log(err);
            });
        }; //Edit

        $("#btnupdate").click(function () {
            var obj = {
                Name: $("#name").val(),
                Address: $("#adress").val(),
                Id: $("#id").val()
            }
            $.ajax({
                url: "/Home/Update",
                type: "POST",
                dataType: "Json",
                data: JSON.stringify(obj),
                contentType: "application/json"
            }).done(function (data) {

                console.log(data.Name);

                LoadData();
                clearall();

            }).fail(function (err) {

                console.log(err.responseText);
            });
        });



        function SaveMenue() {
            if (validateForm()) {

                var data = new FormData();

                data.append("MenueId", $("#menueid").val());
                data.append("MenueName", $("#menuname").val());
                data.append("DishTitle", $("#dishtitle").val());
                data.append("Price", $("#price").val());
                data.append("Materials", $("#materials").val());

                if ($('input[name="active"]').is(':checked')) {
                    data.append("IsActive", true)
                } else {
                    data.append("IsActive", false)
                }

                var files1 = $("#txtimg").get(0).files;
                if (files1.length > 0) {
                    data.append("FileImage", files1[0]);
                } else {
                    data.append("ImsgeUrl", $('#emppicture').attr('src'))
                }



                $.ajax({

                    url: "/Admin/MenueSave",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function () {
                        clearallmenue();
                        LoadMenue();


                    },
                    error: function (errormessage) {
                        //alert(errormessage.responseText);
                    }

                });
            }
        }


        function LoadMenue() {
            $.ajax({
                url: "/Admin/MenueShow",
                type: "GET",
                dataType: "Json"
            }).done(function (data) {

                $("#mnu tbody").empty();
                for (var i = 0; i < data.length; i++) {

                    $("#mnu tbody").append(
                        "<tr><td>" + data[i].MenueName + "</td>" +
                        "<td>" + data[i].DishTitle + "</td>" +
                        "<td>" + data[i].Price + "</td>" +
                        "<td>" + data[i].Materials + "</td>" +
                        "<td>" + data[i].IsActive + "</td>" +
                        "<td><img src=" + data[i].ImsgeUrl + " height='60' width='60' /></td>" +
                        "<td><button class='btn btn-primary'data-toggle='modal' data-target='#exampleModal' onclick='editmenue(" + data[i].MenueId + ")' >Edit</button>" +
                        "<button class='btn btn-danger' onclick='deletemenue(" + data[i].MenueId + ")' >Delete</button></td>" +
                        "</tr>"
                    );
                }
            }).fail(function (err) {
                console.log(err);
            });
        }



        function editmenue(id) {

            $.ajax({
                url: "/Admin/EditMenueShow/" + id,
                type: "GET",
                dataType: "Json",
                contentType: "application/json"

            }).done(function (data) {
                //console.log(data);
                $("#menueid").val(data.MenueId);
                $("#menuname").val(data.MenueName);
                $("#dishtitle").val(data.DishTitle);
                $("#price").val(data.Price);
                $("#materials").val(data.Materials);
                $("#active").attr('checked', data.IsActive);
                $("#emppicture").attr('src', data.ImsgeUrl);

            }).fail(function (err) {

                console.log(err);
            });
        }; //Edit

        function LoadOrder() {
            $.ajax({
                url: "/Admin/OrderShow",
                type: "GET",
                dataType: "Json"
            }).done(function (data) {
                console.log(data);
                $("#tblorder tbody").empty();
                for (var i = 0; i < data.length; i++) {

                    var bookdate;
                    if (data[i].Date != null) {

                        var pdate = new Date(parseInt(data[i].Date.substr(6)));
                        var date = new Date(pdate);
                        var year = date.getFullYear();
                        var rawmonth = date.getMonth() + 1 //getMonth is zero based;
                        var month = rawmonth < 10 ? '0' + rawmonth : rawmonth;
                        var rowday = date.getDate();
                        var day = rowday < 10 ? '0' + rowday : rowday;
                        bookdate = day + "-" + month + "-" + year;

                    }
                    else {

                        bookdate = null
                    }

                    $("#tblorder tbody").append(
                        "<tr><td>" + data[i].Name + "</td>" +
                        "<td>" + data[i].Email + "</td>" +
                        "<td>" + data[i].Phone + "</td>" +
                        "<td>" + data[i].DishTitle + "</td>" +
                        "<td>" + data[i].OrderQuantity + "</td>" +
                        "<td>" + data[i].TotalPrice + "</td>" +
                        "<td>" + bookdate + "</td>" +
                        "<td><button class='btn btn-primary' onclick='confirmorder(" + data[i].OrderId + ")' >Confirm</button>" +
                        "</tr>"
                    );
                }
            }).fail(function (err) {
                console.log(err);
            });
        }
        function confirmorder(id) {

            $.ajax({
                url: "/Admin/ConfirmOrder/" + id,
                type: "GET",
                dataType: "Json"
            }).done(function (data) {
                LoadData();

            }).fail(function (err) {

                console.log(err);
            });
        }; //Edit


        function clearallmenue() {
            $("#menuname").val('');
            $("#dishtitle").val('');
            $("#price").val('');
            $("#materials").val('');
            $("#active").val('');
            $("#txtimg").val('');


        }

        function realtimeuploadpic(input) {

            if (input.files && input.files[0]) {

                var reader = new FileReader();



                reader.onload = function (e) {

                    $('#emppicture').attr('src', e.target.result);

                }

                reader.readAsDataURL(input.files[0]);

            }

        }

        $("#txtimg").change(function () {

            realtimeuploadpic(this);

        });

        function validateForm() {

            var menuname = $("#menuname").val();
            var title = $("#dishtitle").val();
            var price = $("#price").val();
            var material = $("#materials").val();
            var pic = $("#txtimg").val();


            var inputVal = new Array(menuname, title, price, material, pic);

            var inputMessage = new Array("Menue Name", "Title", "Price", "Matrials", "Picture");

            $('.error').hide();

            if (inputVal[0] == "") {
                $('.nmerr').after('<span class="error"> Please enter' + inputMessage[0] + '</span>');
                return false;
            }
            if (inputVal[1] == "") {
                $('.tlerr').after('<span class="error"> Please enter' + inputMessage[1] + '</span>');
                return false;
            }

            if (inputVal[2] == "") {
                $('.prerr').after('<span class="error"> Please enter' + inputMessage[2] + '</span>');
                return false;
            }
            if (inputVal[3] == "") {
                $('.mterr').after('<span class="error"> Please enter' + inputMessage[3] + '</span>');
                return false;
            }
            if (inputVal[4] == "") {
                $('.pcerr').after('<span class="error"> Please enter' + inputMessage[4] + '</span>');
                return false;
            }

            else {
                return true;
            }
        }


    </script>
}